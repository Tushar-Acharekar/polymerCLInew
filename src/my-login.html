<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">


	<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
	<link rel="import" href="../bower_components/paper-card/paper-card.html">
	<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
	<link rel="import" href="../bower_components/paper-button/paper-button.html">
	<link rel="import" href="../bower_components/paper-input/paper-input.html">
	<link rel="import" href="../bower_components/paper-item/paper-item.html">
	<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
	
	
	<script src="https://www.gstatic.com/firebasejs/3.6.6/firebase.js"></script>
	
<dom-module id="my-login">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      
      :host .loginHost{
          display: flex;
          width: 100%;
          height: 85vh;
          align-items: center;
      }
      
      :host .loginPaperCard{
        min-height: 400px;
        width:350px;
        margin: 0px auto;
      }
      
      :host .card-actions{
    		display: flex;
        justify-content: space-around;
    	}
    	
    	:host .hidden{
    	  display:none;
    	}
    </style>
      <div class="loginHost">
				<paper-card image="images/login.png" alt="Pulse" class="loginPaperCard">
				  <div class="card-content">
              <paper-input label="Username" id="email" char-counter required auto-validate error-message="Need Username" autofocus value="{{username}}"></paper-input>
              <paper-input label="Password" id="password" type="password" auto-validate required error-message="Need Password" value="{{password}}"></paper-input>
              <paper-input label="Name" id="name" class="hidden" char-counter required auto-validate error-message="Need Name"></paper-input>		
              <input type="file" id="myFile" class="hidden"  size="50"> 					
				  </div>
				  <div class="card-actions">
              <paper-button id="quickstart-sign-in" name="signin" on-click="_signin">Login</paper-button>
              <paper-button id="quickstart-sign-up" name="signUp" on-click="_signup">SignUp</paper-button>
				  </div>
				</paper-card>
				<paper-toast id="loginToast"></paper-toast>
			</div>
  </template>

  <script>
    class MyLogin extends Polymer.Element {
      static get is() { return 'my-login'; }
      
      static get properties() {
        return {
          username: {
            type: String,
            value:"acharekart@gmail.com",
            reflectToAttribute: true,
            observer: '_userNameChanged'
          },
          password: {
            type: String,
            value:"Pass@123"
          }
        };
      }
      
      connectedCallback() {
        super.connectedCallback();
        console.log('my-login created!');
        var config = {
          apiKey: "AIzaSyCS2aFGvqBAvh5jWrxztKaE0YhtxI7ewx8",
          authDomain: "tushardb-87fc8.firebaseapp.com",
          databaseURL: "https://tushardb-87fc8.firebaseio.com",
          projectId: "tushardb-87fc8",
          storageBucket: "tushardb-87fc8.appspot.com",
          messagingSenderId: "501594027611"
        };
        firebase.initializeApp(config);
      }
      
      attributeChangedCallback(){}
      
      _userNameChanged(page) {
        console.log(this.username);
      }
      
      _signin() {
          var thisElement = this;
          this.$.name.setAttribute("class", "hidden");
          this.$.myFile.setAttribute("class", "hidden");
          firebase.auth().signInWithEmailAndPassword(this.username, this.password).then(function(user) {
          document.querySelector('my-app').page = 'view1';
          
          }).catch(function(error) {
            if (error.code === 'auth/wrong-password') {
              console.log('Wrong password.');
              thisElement.$.loginToast.show("Wrong password.");
            } 
            else if (error.code === 'auth/user-not-found') {
              console.log('user not found, Please SignUP');	
              thisElement.$.loginToast.show("user not found, Please SignUP");
            } 		  
            else {
              console.log("errorCode :" + error.code);
              thisElement.$.loginToast.show("errorCode :" + error.code);
            }
          });
      }
      
      
      _signup() {
        this.$.name.removeAttribute("class", "hidden");
        this.$.myFile.removeAttribute("class", "hidden");
      }      
    }
    
    window.customElements.define(MyLogin.is, MyLogin);	
  </script>
</dom-module>
